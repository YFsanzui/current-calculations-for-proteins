# Include file for Makefile
############################

### Please change below variable 
#F2PY = $(CURP_HOME)/curp-environ/bin/f2py-curp
F2PY = f2py

##### Macro definitions #####

CC = gcc
FC = gfortran
FCOMPILER=
# FCOMPILER=intelem # for intel compiler 11.1
CFLAGS = -c -g -Wall
LOADLIBES = -lm
LDFLAGS = -lm
FFLAGS = -O2 -static

#########################################
ACTIVATE= $(CURP_HOME)/curp-environ/bin/activate
ifdef FCOMPILER
F2PYFLAGS += --fcompiler=$(FCOMPILER)
endif

##### Generation rule definitions #####
.SUFFIXES: .so .f90

.f90.so:
ifneq ($(wildcard $(CURP_HOME)/Pipfile),)
    pipenv run $(F2PY) -c $*.f90 -m $*  $(F2PYFLAGS) && \
    echo "\n[compiled $*.f90 successfully.]\n"
else
	$(F2PY) -c $*.f90 -m $*  $(F2PYFLAGS) && \
	echo "\n[compiled $*.f90 successfully.]\n"
endif

##### Target definitions #####

all: install

intel:
	@$(MAKE) "FCOMPILER=intelem"

clean:
	@rm -f *.so *~ *.mod

tags:
	ctags *.f90

